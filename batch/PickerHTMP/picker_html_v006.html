<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Pick Videos - Tournament</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 2em;
    }
    video {
      width: 300px;
      height: auto;
      margin: 10px;
      border: 3px solid transparent;
      transition: border 0.2s;
      cursor: pointer;
    }
    video:hover {
      border-color: #0077ff;
    }
    .video-container {
      display: flex;
      gap: 20px;
      flex-wrap: wrap;
    }
    .status {
      margin: 1em 0;
    }
    .button-row {
      margin-top: 20px;
    }
    button {
      margin-right: 10px;
      padding: 10px 20px;
      font-size: 1rem;
      cursor: pointer;
    }
    #finalGallery, #allVideosGallery {
      margin-top: 20px;
      display: none;
    }
    #galleryTitle, #allVideosTitle {
      margin-top: 1em;
      display: none;
    }
  </style>
</head>
<body>
  <h1>Pick Between Two Random Videos</h1>
  <input type="file" id="folderInput" webkitdirectory multiple />
  <div class="status" id="status">No folder selected.</div>
  
  <div class="video-container" id="videoContainer"></div>

  <div class="button-row" id="pairButtons" style="display:none;">
    <button id="pickBothBtn">Pick Both</button>
    <button id="pickNoneBtn">Pick None</button>
  </div>

  <div class="button-row">
    <button id="toggleGallery" style="display: none;">Show Picks</button>
    <button id="newRoundButton" style="display: none;">Start New Round Now</button>
    <button id="showAllVideosBtn" style="display: none;">Show All Videos</button>
  </div>

  <h2 id="galleryTitle">üéâ Picked Videos</h2>
  <div class="video-container" id="finalGallery"></div>

  <h2 id="allVideosTitle">üìÅ All Remaining Videos</h2>
  <div class="video-container" id="allVideosGallery"></div>

  <script>
    const folderInput = document.getElementById('folderInput');
    const videoContainer = document.getElementById('videoContainer');
    const finalGallery = document.getElementById('finalGallery');
    const allVideosGallery = document.getElementById('allVideosGallery');
    const status = document.getElementById('status');
    const newRoundButton = document.getElementById('newRoundButton');
    const toggleGalleryBtn = document.getElementById('toggleGallery');
    const galleryTitle = document.getElementById('galleryTitle');
    const allVideosTitle = document.getElementById('allVideosTitle');
    const showAllVideosBtn = document.getElementById('showAllVideosBtn');
    const pickBothBtn = document.getElementById('pickBothBtn');
    const pickNoneBtn = document.getElementById('pickNoneBtn');
    const pairButtons = document.getElementById('pairButtons');

    const videoExtensions = ['.mp4', '.webm', '.mov', '.avi', '.mkv', '.flv', '.wmv'];
    let allVideos = [];
    let pickedVideos = [];
    let galleryVisible = false;
    let allVideosVisible = false;
    let roundCount = 1;
    let currentPair = [];

    folderInput.addEventListener('change', (event) => {
      const files = Array.from(event.target.files);
      allVideos = files.filter(file => {
        const ext = file.name.toLowerCase().substring(file.name.lastIndexOf('.'));
        return videoExtensions.includes(ext);
      });

      pickedVideos = [];
      roundCount = 1;
      shuffleArray(allVideos);
      resetUI();
      showNextPair();
    });

    function showNextPair() {
      videoContainer.innerHTML = '';
      pairButtons.style.display = 'none';
      currentPair = [];
      updateStatus();
      hideAllVideosGallery();

      if (allVideos.length === 0) {
        if (pickedVideos.length === 1) {
          status.textContent = `üèÜ Final video selected after ${roundCount} rounds!`;
          pairButtons.style.display = 'none';
          return;
        } else if (pickedVideos.length > 1) {
          startNewRound();
          return;
        } else {
          status.textContent = `No videos left. Nothing picked.`;
          return;
        }
      }

      if (allVideos.length >= 2) {
        currentPair = allVideos.splice(0, 2);
        currentPair.forEach(displayVideoOption);
        pairButtons.style.display = 'block';
      } else {
        // Only one video left, just show it as single pick option
        currentPair = [allVideos.shift()];
        displayVideoOption(currentPair[0]);
        pairButtons.style.display = 'block';
      }
    }

    function displayVideoOption(file) {
      const url = URL.createObjectURL(file);
      const video = document.createElement('video');
      video.src = url;
      video.muted = true;
      video.loop = true;
      video.autoplay = true;
      video.playsInline = true;
      video.setAttribute('preload', 'metadata');

      video.addEventListener('click', () => {
        pickedVideos.push(file);
        updateGallery();
        showNextPair();
      });

      videoContainer.appendChild(video);
    }

    function startNewRound() {
      allVideos = [...pickedVideos];
      pickedVideos = [];
      shuffleArray(allVideos);
      roundCount++;
      resetUI();
      showNextPair();
    }

    newRoundButton.addEventListener('click', () => {
      if (pickedVideos.length >= 1) {
        startNewRound();
      }
    });

    toggleGalleryBtn.addEventListener('click', () => {
      galleryVisible = !galleryVisible;
      finalGallery.style.display = galleryVisible ? 'flex' : 'none';
      galleryTitle.style.display = galleryVisible ? 'block' : 'none';
      toggleGalleryBtn.textContent = galleryVisible ? 'Hide Picks' : 'Show Picks';
    });

    showAllVideosBtn.addEventListener('click', () => {
      allVideosVisible = !allVideosVisible;
      if (allVideosVisible) {
        showAllVideos();
        allVideosGallery.style.display = 'flex';
        allVideosTitle.style.display = 'block';
        showAllVideosBtn.textContent = 'Hide All Videos';
      } else {
        hideAllVideosGallery();
      }
    });

    pickBothBtn.addEventListener('click', () => {
      pickedVideos.push(...currentPair);
      updateGallery();
      showNextPair();
    });

    pickNoneBtn.addEventListener('click', () => {
      // Just skip the current pair, no picks added
      showNextPair();
    });

    function showAllVideos() {
      allVideosGallery.innerHTML = '';
      allVideos.forEach(file => {
        const url = URL.createObjectURL(file);
        const video = document.createElement('video');
        video.src = url;
        video.muted = true;
        video.loop = true;
        video.autoplay = true;
        video.playsInline = true;
        video.setAttribute('preload', 'metadata');
        allVideosGallery.appendChild(video);
      });
    }

    function hideAllVideosGallery() {
      allVideosGallery.style.display = 'none';
      allVideosTitle.style.display = 'none';
      showAllVideosBtn.textContent = 'Show All Videos';
      allVideosVisible = false;
    }

    function updateGallery() {
      finalGallery.innerHTML = '';
      for (const file of pickedVideos) {
        const url = URL.createObjectURL(file);
        const video = document.createElement('video');
        video.src = url;
        video.muted = true;
        video.loop = true;
        video.autoplay = true;
        video.playsInline = true;
        video.setAttribute('preload', 'metadata');
        finalGallery.appendChild(video);
      }

      if (pickedVideos.length > 0) {
        newRoundButton.style.display = 'inline-block';
      }
      toggleGalleryBtn.style.display = pickedVideos.length > 0 ? 'inline-block' : 'none';
    }

    function updateStatus() {
      status.textContent = `üéØ Round ${roundCount}: ${allVideos.length} videos left to pick from | ${pickedVideos.length} picked so far.`;
      if (allVideos.length > 0) {
        showAllVideosBtn.style.display = 'inline-block';
      } else {
        showAllVideosBtn.style.display = 'none';
        hideAllVideosGallery();
      }
    }

    function resetUI() {
      videoContainer.innerHTML = '';
      finalGallery.innerHTML = '';
      galleryTitle.style.display = 'none';
      finalGallery.style.display = 'none';
      toggleGalleryBtn.style.display = 'none';
      toggleGalleryBtn.textContent = 'Show Picks';
      galleryVisible = false;
      newRoundButton.style.display = 'none';
      showAllVideosBtn.style.display = 'none';
      allVideosGallery.style.display = 'none';
      allVideosTitle.style.display = 'none';
      pairButtons.style.display = 'none';
      currentPair = [];
      updateStatus();
    }

    function shuffleArray(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
    }
  </script>
</body>
</html>
